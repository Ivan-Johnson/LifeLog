#!/bin/env bash
#exit on Error (even within a pipeline) and treat Unset variables as errors
set -euo pipefail
#for tracing
#set -x

DIR_ROOT="$(dirname "$0")/../"

git stash push -m "Prepping for pre-commit test" -q --include-untracked --keep-index

branch=$(git rev-parse --abbrev-ref HEAD)

code=0

echo "Testing... "
VALID_TEST=$(./test.bash > /dev/null; echo $?)
if [ "$VALID_TEST" != "0" ]; then
	code=1;
	echo "TESTS FAILED!"
else
	echo "Tests passed"
fi

git stash pop -q

exit $code
